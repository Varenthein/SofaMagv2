"use strict";var container=$(".content"),issue="";var presentPage=0;var timer,config={social:!1,text_at:window.innerHeight,timer:!0,timer_time:20,url:"http://sofasport.pl/e-mag/index.html?id="+window.$_GET.id};function setNavTo(a){$("nav h2").innerText=pages[a-1].title,$("nav a:first-of-type").innerHTML=pages[a-2]==void 0?"G\u0142\xF3wna":pages[a-2].title,$("nav a:first-of-type").href="javascript:scrollToPage("+(a-1)+")",$("nav a:last-of-type").innerHTML=pages[a]==void 0?"Koniec":pages[a].title,$("nav a:last-of-type").href=a+1<=pages.length?"javascript:scrollToPage("+(a+1)+")":"javascript:scrollToPage(0)"}function countdown(){var a=parseInt($("nav .after").innerText);0==a?(clearInterval(timer),a=config.timer_time,$("nav a.go-right").click()):a--,$("nav .after").innerText=a}function scrollToPage(){var b=0<arguments.length&&arguments[0]!==void 0?arguments[0]:0;presentPage=b;var a=Math.max(document.documentElement.clientWidth,window.innerWidth||0)*b;768<Math.max(document.documentElement.clientWidth,window.innerWidth||0)&&(console.log(a),window.scrollIt(a,1),$All(".page .please-share").forEach(function(c){return c.fadeOut()}),$("nav a.go-right").classList.remove("timer"),window.clearInterval(timer),$All(".content .page").forEach(function(c){return c.classList.remove("active")}),b<=pages.length&&$(".content article:nth-of-type("+(b+1)+")").classList.add("active"),0<b&&setNavTo(b))}function createPages(a){var c=document.createElement("article");c.className="front_page",c.innerHTML="\n    <img src=\""+issue.cover+"\" alt=\"cover\" class=\"cover\">\n    <button><span class=\"fa fa-play\" aria-hidden=\"true\"></span></button>\n  ",container.appendChild(c),container.innerHTML+=a.map(function(f){return"\n     <article class=\"page\">\n        "+f.content+"\n     </article>\n     "}).join(""),$(".front_page button").addEventListener("click",function(){scrollToPage(1)},!1);var d=document.createElement("nav");d.innerHTML="\n<a class=\"go-left\">None</a>\n<h2>Unnamed</h2>\n<a class=\"go-right\">None</a><div class=\"after\">"+config.timer_time+"</div>\n",document.body.appendChild(d),setTimeout(function(){window.scroll(0,0)},100);var e=document.createElement("div");if(e.className="social",e.style.display="none",e.innerHTML="\n    <ul>\n          <li><h6>Share</h6></li>\n          <li><a class=\"icoHeart\" title=\"Heart\"><i class=\"fa fa-heart\" class=\"Heart\"></i></a></li>\n          <li><a class=\"icoFacebook\" title=\"Facebook\"><i class=\"fa fa-facebook\" title=\"Facebook\"></i></a></li>\n          <li><a class=\"icoTwitter\" title=\"Twitter\"><i class=\"fa fa-twitter\" title=\"Twitter\"></i></a></li>\n          <li><a class=\"icoGoogle\" title=\"Google\"><i class=\"fa fa-google-plus\" title=\"Google\"></i></a></li>\n          <li><a onClick=\"alert('This option is inactive...')\" class=\"icoBookmark\" title=\"Read later\"><i class=\"fa fa-bookmark-o\"></i></a></li>\n    </ul>",document.body.appendChild(e),e.addEventListener("click",function(f){var g="",h=768>Math.max(document.documentElement.clientWidth,window.innerWidth||0);if("Facebook"==f.target.title)g=h?"https://www.facebook.com/sharer/sharer.php?u="+config.url:"https://www.facebook.com/sharer/sharer.php?u="+config.url+"&page="+presentPage;else if("Twitter"==f.target.title)g=h?"https://twitter.com/home?status="+encodeURIComponent("Polecam "+issue.title+" - "+config.url):"https://twitter.com/home?status="+encodeURIComponent(a[presentPage].title+" #SofaMagazyn "+config.url+"&page"+presentPage),console.log(h,Math.max(document.documentElement.clientWidth,window.innerWidth||0));else if("Google"==f.target.title)g=h?"https://plus.google.com/share?url="+encodeURIComponent(a[presentPage].title+" #SofaMagazyn "+config.url):"https://plus.google.com/share?url="+encodeURIComponent(a[presentPage].title+" #SofaMagazyn "+config.url+"&page"+presentPage);else if("Heart"==f.target.title){var i=new XMLHttpRequest;i.open("POST","https://formspree.io/raventhein@gmail.com",!0),i.setRequestHeader("Content-Type","application/json; charset=utf-8"),i.onreadystatechange=function(){4!=i.readyState||200!=i.status},i.send(JSON.stringify({message:"Somebody liked it"}))}""!=g&&window.open(g)}),!isNaN(window.$_GET.page)){var b=parseInt(window.$_GET.page);setNavTo(b),presentPage=b,scrollToPage(b)}}function errorPage(a){var b=document.createElement("article");b.className="not_found",b.innerHTML="<h1>"+a+"</h1>",$(".content").appendChild(b)}function checkScroll(){window.scrollY>config.text_at&&"none"==$(".social").style.display||window.scrollY>config.text_at&&!1==config.social?(!0==config.social&&$(".social").fadeIn(),$("nav").classList.add("scrolled")):(window.scrollY<config.text_at&&"block"==$(".social").style.display||window.scrollY<config.text_at&&!1==config.social)&&(!0==config.social&&$(".social").fadeOut(),$("nav").classList.remove("scrolled"),$All(".page .please-share").forEach(function(a){return a.fadeOut()})),window.scrollY+window.innerHeight>document.body.getBoundingClientRect().height-100&&"none"==$(".page .please-share").style.display&&($All(".page .please-share").forEach(function(a){return a.fadeIn()}),config.timer&&$("nav a.go-right").classList.add("timer"),window.clearInterval(timer),config.timer&&(timer=setInterval(function(){countdown()},1e3)),config.timer&&($("nav h2").innerHTML="<strong>Nast\u0119pny:</strong> "+$("nav a.go-right").innerText))}window.addEventListener("resize",function(){scrollToPage(presentPage)}),window.addEventListener("scroll",function(){checkScroll()}),window.$_GET.id===void 0?errorPage("404 not found..."):(issue=data.filter(function(a){return a.id==window.$_GET.id}),1>issue.length?errorPage("There is no such issue in the database..."):(issue=issue[0],loadFile("templates/"+issue.template+"/template.js","js").then(function(){loadFile(issue.url+"/pages.js","js").then(function(){console.info("e-Mag: Pages loaded properly!"),createPages(pages)},function(b){console.error(b),errorPage("Pages file not found...")})},function(a){console.error(a);var b=document.createElement("article");b.className="not_found",b.innerHTML="<h1>Template file not found...</h1>",$(".content").appendChild(b)}),loadFile("templates/"+issue.template+"/style.css","css"),loadFile(issue.url+"/style.css","css")));
